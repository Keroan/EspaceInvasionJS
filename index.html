
<html>
	<head>
		<title>Espace Invasion JS</title>
	</head>
	
	<body style='background-color : #000' onkeydown='keyIsDown(event)' onkeyup='keyIsUp(event)'>
		<div style='padding : 0px; width : 800px; margin : auto'>
			<canvas id='canvas' width='800px' height='600px'></canvas>
		</div>
		
	
		<script>
			var alphabet = [];
			alphabet['A'] = 
			[
				[0,0,1,1,0,0],
				[0,1,0,0,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,1,1,1,1,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1]
			];
			alphabet['B'] = 
			[
				[1,1,1,1,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,1,1,1,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,1,1,1,1,0]
			];
			alphabet['C'] = 
			[
				[0,0,1,1,1,1,0],
				[0,1,0,0,0,0,1],
				[1,0,0,0,0,0,0],
				[1,0,0,0,0,0,0],
				[1,0,0,0,0,0,0],
				[1,0,0,0,0,0,0],
				[0,1,0,0,0,0,1],
				[0,0,1,1,1,1,0]
			];
			alphabet['D'] = 
			[
				[1,1,1,1,0,0],
				[1,0,0,0,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,1,0],
				[1,1,1,1,0,0]
			];
			alphabet['E'] = 
			[
				[1,1,1,1,1,1],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,1,1,1,1,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,1,1,1,1,1]
			];
			alphabet['F'] = 
			[
				[1,1,1,1,1,1],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,1,1,1,1,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0]
			];
			
			alphabet['G'] = 
			[
				[0,0,1,1,1,1,0],
				[0,1,0,0,0,0,1],
				[1,0,0,0,0,0,0],
				[1,0,0,0,0,0,0],
				[1,0,0,1,1,1,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,0,1],
				[0,0,1,1,1,1,0]
			];
			
			alphabet['H'] = 
			[
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,1,1,1,1,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1]
			];
			alphabet['I'] = 
			[
				[0,1,0],
				[0,1,0],
				[0,1,0],
				[0,1,0],
				[0,1,0],
				[0,1,0],
				[0,1,0],
				[0,1,0]
			];
			
			alphabet['J'] = 
			[
				[0,0,0,0,0,1],
				[0,0,0,0,0,1],
				[0,0,0,0,0,1],
				[0,0,0,0,0,1],
				[0,0,0,0,0,1],
				[0,0,0,0,0,1],
				[1,0,0,0,0,1],
				[0,1,1,1,1,0]
			];
			
			alphabet['K'] = 
			[
				[1,0,0,0,0,1],
				[1,0,0,0,1,0],
				[1,0,0,1,0,0],
				[1,0,1,0,0,0],
				[1,1,1,0,0,0],
				[1,0,0,1,0,0],
				[1,0,0,0,1,0],
				[1,0,0,0,0,1]
			];
			
			alphabet['L'] = 
			[
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0],
				[1,1,1,1,1,1]
			];
			
			alphabet['M'] = 
			[
				[1,0,0,0,0,0,1],
				[1,1,0,0,0,1,1],
				[1,0,1,0,1,0,1],
				[1,0,0,1,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1]
			];
		
			alphabet['N'] = 
			[
				[1,0,0,0,0,1],
				[1,1,0,0,0,1],
				[1,0,1,0,0,1],
				[1,0,0,1,0,1],
				[1,0,0,0,1,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1]
			];
			
			alphabet['O'] = 
			[
				[0,0,1,1,1,0,0],
				[0,1,0,0,0,1,0],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,1,0],
				[0,0,1,1,1,0,0]
			];
			
			alphabet['P'] = 
			[
				[1,1,1,1,0,0],
				[1,0,0,0,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,1,0],
				[1,1,1,1,0,0],
				[1,0,0,0,0,0],
				[1,0,0,0,0,0]
			];
			
			alphabet['Q'] = 
			[
				[0,0,1,1,1,0,0],
				[0,1,0,0,0,1,0],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,1,0],
				[0,0,1,1,1,0,0],
				[0,0,0,0,1,0,0],
				[0,0,0,0,1,1,1]
			];
			
			alphabet['R'] = 
			[
				[1,1,1,1,0,0],
				[1,0,0,0,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,1,0],
				[1,1,1,1,0,0],
				[1,0,0,0,1,0],
				[1,0,0,0,0,1]
			];
			
			alphabet['S'] = 
			[
				[0,1,1,1,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,0],
				[0,1,1,0,0,0],
				[0,0,0,1,1,0],
				[0,0,0,0,0,1],
				[1,0,0,0,0,1],
				[0,1,1,1,1,0]
			];
			
			alphabet['T'] = 
			[
				[1,1,1,1,1],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0]
				
			];
			
			alphabet['U'] = 
			[
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[0,1,0,0,1,0],
				[0,0,1,1,0,0]
				
			];
			
			alphabet['V'] = 
			[
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,1,0],
				[0,1,0,0,0,1,0],
				[0,0,1,0,1,0,0],
				[0,0,1,0,1,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0]
			];
			alphabet['W'] = 
			[
				[1,0,0,0,1,0,0,0,1],
				[1,0,0,0,1,0,0,0,1],
				[1,0,0,0,1,0,0,0,1],
				[0,1,0,1,0,1,0,1,0],
				[0,1,0,1,0,1,0,1,0],
				[0,1,0,1,0,1,0,1,0],
				[0,0,1,0,0,0,1,0,0],
				[0,0,1,0,0,0,1,0,0]
			];
			
			alphabet['X'] = 
			[
				[1,0,0,0,0,1],
				[1,0,0,0,0,1],
				[0,1,0,0,1,0],
				[0,0,1,1,0,0],
				[0,0,1,1,0,0],
				[0,1,0,0,1,0],
				[1,0,0,0,0,1],
				[1,0,0,0,0,1]
			];
			
			
			alphabet['Y'] = 
			[
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,1,0],
				[0,0,1,0,1,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0]
			];
			
			alphabet['Y'] = 
			[
				[1,0,0,0,0,0,1],
				[1,0,0,0,0,0,1],
				[0,1,0,0,0,1,0],
				[0,0,1,0,1,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0],
				[0,0,0,1,0,0,0]
			];
			
			alphabet['1'] = 
			[
				[0,0,1,0,0],
				[0,1,1,0,0],
				[1,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[1,1,1,1,1]
			];
			
			alphabet['2'] = 
			[
				[0,1,1,1,0],
				[1,0,0,0,1],
				[0,0,0,0,1],
				[0,0,0,1,0],
				[0,0,1,0,0],
				[0,1,0,0,0],
				[1,0,0,0,0],
				[1,1,1,1,1]
			];
			
			alphabet['0'] = 
			[
				[0,0,1,1,0,0],
				[0,1,0,0,1,0],
				[1,0,0,1,0,1],
				[1,0,0,1,0,1],
				[1,0,1,0,0,1],
				[1,0,1,0,0,1],
				[0,1,0,0,1,0],
				[0,0,1,1,0,0]
			];
			
			alphabet['5'] = 
			[
				[1,1,1,1,1],
				[1,0,0,0,0],
				[1,0,0,0,0],
				[0,1,1,1,0],
				[0,0,0,0,1],
				[0,0,0,0,1],
				[0,0,0,0,1],
				[1,1,1,1,0]
			];
			
			alphabet['7'] = 
			[
				[1,1,1,1,1],
				[1,0,0,0,1],
				[0,0,0,1,0],
				[0,0,0,1,0],
				[0,0,1,0,0],
				[0,0,1,0,0],
				[0,1,0,0,0],
				[0,1,0,0,0]
			];
			
			alphabet['6'] = 
			[
				[0,1,1,1,1],
				[1,0,0,0,0],
				[1,0,0,0,0],
				[1,1,1,1,0],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,0]
			];
			alphabet['8'] = 
			[
				[0,1,1,1,0],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,0],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,0]
			];
			
			alphabet['3'] = 
			[
				[0,1,1,1,0],
				[1,0,0,0,1],
				[0,0,0,0,1],
				[0,1,1,1,0],
				[0,0,0,0,1],
				[0,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,0]
			];
			
			alphabet['9'] = 
			[
				[0,1,1,1,0],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,1],
				[0,0,0,0,1],
				[0,0,0,0,1],
				[1,0,0,0,1],
				[0,1,1,1,0]
			];
			alphabet['4'] = 
			[
				[0,0,0,1,0],
				[0,0,1,1,0],
				[0,1,0,1,0],
				[1,0,0,1,0],
				[1,1,1,1,1],
				[0,0,0,1,0],
				[0,0,0,1,0],
				[0,0,0,1,0]
			];
			
			alphabet['-'] = 
			[
				
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[1,1,1,1,1],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0]
			];
			
			alphabet[' '] = 
			[
				
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0],
				[0,0,0,0,0]
			];
			
			alphabet['invader'] = 
			[
				[0,0,1,0,0,0,0,0,1,0,0],
				[0,0,0,1,0,0,0,1,0,0,0],
				[0,0,1,1,1,1,1,1,1,0,0],
				[0,1,1,0,1,1,1,0,1,1,0],
				[1,1,1,1,1,1,1,1,1,1,1],
				[1,0,1,1,1,1,1,1,1,0,1],
				[1,0,1,0,0,0,0,0,1,0,1],
				[0,0,0,1,1,0,1,1,0,0,0]
			]
			
			alphabet['smallShip'] = 
			[
				[1,0,0,1],
				[1,1,1,1],
				[1,0,0,1],
				[0,1,1,0]
			]
			
			alphabet['round'] = 
			[
				[0,1,1,0],
				[1,0,0,1],
				[1,0,0,1],
				[0,1,1,0]
			]
			
			
			alphabet['fighter'] = 
			[
				[0,0,0,0,0,1,0,0,0,0,0],
				[0,0,0,0,1,1,1,0,0,0,0],
				[0,0,0,0,1,0,1,0,0,0,0],
				[0,0,0,1,1,0,1,1,0,0,0],
				[0,0,1,0,1,0,1,0,1,0,0],
				[0,1,0,0,1,0,1,0,0,1,0],
				[1,1,1,1,1,1,1,1,1,1,1],
				[0,0,1,1,1,0,1,1,1,0,0]
			]
			
			var lifeIndex = [0, 8, 10, 46];
			var patternIndex = [null, alphabet['round'],alphabet['smallShip'],alphabet['invader']];
			
			var ctx = document.getElementById('canvas').getContext('2d');  

			
			function drawIt(pattern, x, y)
			{
				var i = 0;
				ctx.fillStyle = GAME_COLOUR;
				while (i < pattern.length)
				{
					var row = pattern[i];
					var j = 0;
					while (j < row.length)
					{
						if (row[j])
						{
							
							ctx.beginPath();  
							ctx.arc(x + j * 10, y + i * 10,4.5,0,Math.PI*2,true);
							ctx.fill();
							ctx.closePath();
						}
						++j;
					}
					++i;
				}
			}
			
			function drawIt5(pattern, x, y)
			{
				var i = 0;
				ctx.fillStyle = GAME_COLOUR;
				while (i < pattern.length)
				{
					var row = pattern[i];
					var j = 0;
					while (j < row.length)
					{
						if (row[j])
						{
							
							ctx.beginPath();  
							ctx.arc(x + j * 5, y + i * 5,2,0,Math.PI*2,true);
							ctx.fill();
							ctx.closePath();
						}
						++j;
					}
					++i;
				}
			}
			
			function duplicatePatern(pattern)
			{
				var newPattern = [];
				
				var i = 0;
				while (i < pattern.length)
				{
					var j = 0;
					newPattern[i] = [];
					while (j < pattern[i].length)
					{	
						newPattern[i][j] = pattern[i][j];
						j++;
					}
					++i;
				}
				
				return newPattern;
			}
			
			var SHIP = 
			{
				X  : 340
			}
			
			var BAD_ASS = 
			[
				
			];
			var SCORE = 0;
			
			var COLOURS = ['#fe6100', '#00fe61', '#fe0061', '#0061fe', '#61fe00','#6100fe']
			
			var GAME_COLOUR = '#fe6100';
			
			var GAME_OVER = 0;
			
			var REMANCE = 0;
			
	 		var projectiles =[];
			
			var lvlMap =
			[
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0],
				[0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],
				[0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0],
				[0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0],
				[0,0,1,0,0,0,0,2,2,0,0,0,0,1,0,0],
				[0,0,0,1,0,0,2,0,0,2,0,0,1,0,0,0],
				[0,0,0,1,0,0,2,2,2,2,0,0,1,0,0,0],
				[0,0,1,0,0,0,2,0,0,2,0,0,0,1,0,0]
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],
				[0,0,0,0,2,0,0,2,2,0,0,2,0,0,0,0],
				[0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,3,0,0,1,1,0,3,0,0,0,0,0],
				[0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0],
				[0,0,0,0,1,0,0,1,1,0,0,1,0,0,0,0],
				[0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0],
				[0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0],
				[0,0,1,0,2,0,1,1,1,1,0,2,0,1,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0],
				[0,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0],
				[0,0,0,0,2,0,1,0,0,1,0,2,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,1,2,0,0,0,0,3,0,0],
				[0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,2,2,0,0,0,0,3,0,0],
				[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
				[0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0],
				[0,0,2,0,0,0,0,1,0,0,0,0,0,0,2,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,3,0,0,0,3,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,3,0,0,0,3,0,0,0,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0],
				[0,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0],
				[0,0,0,0,2,0,1,0,0,1,0,2,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,1,2,0,0,0,0,3,0,0],
				[0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0],
				[0,0,3,0,0,0,0,2,2,0,0,0,0,3,0,0],
				[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
				[0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0],
				[0,0,2,0,0,0,0,1,0,0,0,0,0,0,2,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,3,0,0,0,3,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,3,0,0,0,3,0,0,0,3,0,0,0,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0],
				[0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,0]
				
			]
			
			
			function generateLvl()
			{
				var i = 0;
				
				while (i < lvlMap.length)
				{
					var turn = 
					{
						turn : i * 50,
						fly  : []
					};
					var j = 0;
					while (j < lvlMap[i].length)
					{
						if (lvlMap[i][j])
						{
							var m = {
								type : lvlMap[i][j],
								x 	 : j * 50,
								s 	 : 10,
								l 	: lifeIndex[lvlMap[i][j]]
							};
							turn.fly.push(m);
						}
						++j;
					}
					if (turn.fly.length)
					{
						lvl.push(turn);
					}
					++i;
				}
				lvl.push({
					turn : 0
				});
			}
			var lvl = [
						
			];
			generateLvl();
			var TURN   =  0;
			var LVLINDEX = 0;
			var particles = [];
			var PLAY = 0;
			function improve()
			{
				TURN++;
				
				while (lvl[LVLINDEX].turn == TURN)
				{
					var fly = lvl[LVLINDEX].fly;
					var i = 0;
					while (i < fly.length)
					{
						var p  = {
						pattern : duplicatePatern(patternIndex[fly[i].type]),
						X 		: fly[i].x,
						Y 		: 10,
						XS 		: 1,
						YS 		: fly[i].s,
						AC 		: 0,
						S 		:fly[i].s,
						l		: fly[i].l
						}
						BAD_ASS.push(p);
						++i;
					}
					LVLINDEX++;
				}
		
			}
			
			function explodeParticle(x, y)
			{
				var i = 0;

				while (i < 42)
				{
					var angle = Math.random() * Math.PI*2;
					var speed = Math.random() * 10.;
					var p =
					{
						x : x, 
						y : y,                      
						xs: Math.sin(angle) * speed,
						ys: Math.cos(angle) * speed,
						s  : 4,
						l  : 60
					}
					particles.push(p);
					++i;
				}
				REMANCE = 10;
			}
			
			function renderInvader()
			{
				var i = 0;
				
				while (i < BAD_ASS.length)
				{
					ba =  BAD_ASS[i];
					drawIt(ba.pattern, ba.X,ba.Y);
					++i;
				}
			}
			
			function renderParticles()
			{
				var i = 0;
				
				while (i < particles.length)
				{
					p =  particles[i]; 
					ctx.beginPath();  
					ctx.arc(p.x, p.y,p.s,0,Math.PI*2,true);
					ctx.fill();
					ctx.closePath();
					++i;
				}
			}
			
			function animateParticles()
			{
				var i = 0;
				
				while (i < particles.length)
				{
					p =  particles[i]; 
					p.l--;
					if (p.l)
					{
						p.x += p.xs;
						p.y += p.ys;
						p.s = p.s * 0.95;
						p.xs = p.xs * 0.90;
						p.ys = p.ys * 0.90;
					}
					else
					{
						particles.splice(i, 1);
						--i;
					}
					++i;
				}
			}
				
			function render()
			{
				ctx.fillStyle = '#000';
				if (REMANCE)
				{
					REMANCE--;
					ctx.globalAlpha = 1.0 - (REMANCE / 10);
				}
				
				ctx.fillRect(0,0,800,600);
				ctx.globalAlpha = 1.0;
				renderInvader();
				drawIt(alphabet['fighter'], SHIP.X,520);
				
				renderProjectiles();
				
				renderParticles();
				renderScore();
				
				if(PLAY == 0)
				{
					ctx.fillStyle = GAME_COLOUR;
					var i = 0;
					var x = 170;
					var go = 'ESPACE INVASION JS';
					while (i < go.length)
					{
						var letter = alphabet[go[i]];
						drawIt5(letter, x, 250);
						x += letter[0].length * 5 + 5;
						++i;
					}
					var i = 0;
					var x = 120;
					var go = 'FLECHES POUR BOUGER';
					while (i < go.length)
					{
						var letter = alphabet[go[i]];
						drawIt5(letter, x, 330);
						x += letter[0].length * 5 + 5;
						++i;
					}
					var i = 0;
					var x = 140;
					var go = 'ESPACE POUR TIRER';
					while (i < go.length)
					{
						var letter = alphabet[go[i]];
						drawIt5(letter, x, 380);
						x += letter[0].length * 5 + 5;
						++i;
					}
				}
				
			}
			
			function renderScore()
			{
				ctx.fillStyle = GAME_COLOUR;
				var score = SCORE + ' ';
				var i = 0;
				var x = 10;
				while (i < score.length)
				{
					var letter = alphabet[score[i]];
					drawIt5(letter, x, 560);
					x += letter[0].length * 5 + 5;
					++i;
				}
			}
			
			function renderProjectiles()
			{
				var i = 0;
				ctx.fillStyle = GAME_COLOUR;
				while (i < projectiles.length)
				{
					var p = projectiles[i];
					ctx.beginPath();  
					ctx.arc(p.X, p.Y,4.5,0,Math.PI*2,true);
					ctx.fill();
					ctx.closePath();
					++i;
				}
			}
			
			function input()
			{
				if (keyBoard.left)
				{
					if (SHIP.X > 15)
					{
						SHIP.X -= 10;
					}
				}
				if (keyBoard.right)
				{
					if (SHIP.X < 690)
					{
						SHIP.X += 10;
					}
				}
				
				if (keyBoard.fire)
				{
					var p = 
					{
						X : SHIP.X + 50,
						Y : 520
					}
					projectiles.push(p);
				}
			}
			
			function animate()
			{
				var i = 0;
				animateParticles();
				
				while (i < projectiles.length)
				{
					projectiles[i].Y -= 10;
					if (projectiles[i].Y < 0)
					{
						projectiles.splice(i, 1); 
						--i;
					}
					++i;
				}
			
				i = 0;
				
				while (i <  BAD_ASS.length)
				{
					if (BAD_ASS[i].AC == BAD_ASS[i].S)
					{
						BAD_ASS[i].AC = 0;
						BAD_ASS[i].Y += 10;
						
						if (BAD_ASS[i].Y == 550)
							GAME_OVER = 1;
						
					}
					BAD_ASS[i].AC++;
					++i;
				}
				
			}
			
			function collide()
			{
				
				var i = 0;
				
				while (i < projectiles.length)
				{
					var p = projectiles[i];
					var j = 0;
					while (j < BAD_ASS.length)
					{
						var b = BAD_ASS[j];
						if (p.X >= b.X 
						&& p.Y >= b.Y
						&& (p.Y - b.Y) / 10 < b.pattern.length
						&& (p.X - b.X) / 10 <  b.pattern[0].length)
						{
							if (b.pattern[(p.Y - b.Y) / 10][(p.X - b.X) / 10])
							{
								b.pattern[(p.Y - b.Y) / 10][(p.X - b.X) / 10] = 0;
								
								explodeParticle(p.X, p.Y);
								projectiles.splice(i,1);
								b.l--;
								if (b.l == 0)
								{
									BAD_ASS.splice(j,1);	
									SCORE += 100;
								}
								else
								{
									SCORE += 10;
								}
								--i;
								break;
									
							}
						}
						++j;
					}
					++i;
				}
			}
			
			function gameOver()
			{
				ctx.globalAlpha = 0.8;
				ctx.fillStyle = '#000';
				ctx.fillRect(0,0,800,600);
				ctx.globalAlpha = 1.0;
				ctx.fillStyle = GAME_COLOUR;
				
				var i = 0;
				var x = 100;
				var go = 'PERDU';
				while (i < go.length)
				{
					var letter = alphabet[go[i]];
					drawIt(letter, x, 200);
					x += letter[0].length * 10 + 10;
					++i;
				}
				
				var i = 0;
				var x = 160;
				var go = 'F5 POUR REJOUER';
				while (i < go.length)
				{
					var letter = alphabet[go[i]];
					drawIt5(letter, x, 300);
					x += letter[0].length * 5 + 5;
					++i;
				}
				
				var i = 0;
				var x = 110;
				var go = SCORE + ' ';
				while (i < go.length)
				{
					var letter = alphabet[go[i]];
					drawIt(letter, x, 400);
					x += letter[0].length * 10 + 10;
					++i;
				}
			}

			var COLOR_INDEX = 0;
			function run()
			{
				if (Math.random() > 0.995)
				{
					GAME_COLOUR = COLOURS[COLOR_INDEX++ % COLOURS.length];
				}
				input();
				animate();
				collide();
				improve();
				render();
				if (!GAME_OVER)
					requestAnimFrame(run);
				else
					gameOver();
			}
			
			var keyBoard =
			{
				left : 0,
				right :0,
				fire : 0
			}
			
			function keyIsDown(event)
			{
				if(event.keyCode == 37)
				{
					keyBoard.left = 1;
					PLAY = 1;
				}
				
				if(event.keyCode == 39)
				{
					keyBoard.right = 1;
					PLAY = 1;
				}
				if(event.keyCode == 32)
				{
					keyBoard.fire = 1;
					PLAY = 1;
				}
			}
			
			function keyIsUp(event)
			{
				if(event.keyCode == 37)
				{
					keyBoard.left = 0;
				}
				
				if(event.keyCode == 39)
				{
					keyBoard.right = 0;
				}
				if(event.keyCode == 32)
				{
					keyBoard.fire = 0;
				}
			}
			
			window.requestAnimFrame = 	
			(function()
				{
					return  window.requestAnimationFrame || 
					window.webkitRequestAnimationFrame || 
					window.mozRequestAnimationFrame    || 
					window.oRequestAnimationFrame      || 
					window.msRequestAnimationFrame     || 
					function(callback, element)
					{
						window.setTimeout(callback, 1000 / 60);
					};
				}
			)();
			
			run(); // le jeu commence ici !!! 
		</script>
	
	</body>


</html>